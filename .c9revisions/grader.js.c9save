{"ts":1373352495376,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"#!/usr/bin/env node\n/*\nAutomatically grade files for the presence of specified HTML tags/attributes.\nUses commander.js and cheerio. Teaches command line application development\nand basic DOM parsing.\n\nReferences:\n\n + cheerio\n   - https://github.com/MatthewMueller/cheerio\n   - http://encosia.com/cheerio-faster-windows-friendly-alternative-jsdom/\n   - http://maxogden.com/scraping-with-node.html\n\n + commander.js\n   - https://github.com/visionmedia/commander.js\n   - http://tjholowaychuk.com/post/9103188408/commander-js-nodejs-command-line-interfaces-made-easy\n\n + JSON\n   - http://en.wikipedia.org/wiki/JSON\n   - https://developer.mozilla.org/en-US/docs/JSON\n   - https://developer.mozilla.org/en-US/docs/JSON#JSON_in_Firefox_2\n*/\n\nvar fs = require('fs');\nvar program = require('commander');\nvar cheerio = require('cheerio');\nvar HTMLFILE_DEFAULT = \"index.html\";\nvar CHECKSFILE_DEFAULT = \"checks.json\";\n\nvar assertFileExists = function(infile) {\n    var instr = infile.toString();\n    if(!fs.existsSync(instr)) {\n        console.log(\"%s does not exist. Exiting.\", instr);\n        process.exit(1); // http://nodejs.org/api/process.html#process_process_exit_code\n    }\n    return instr;\n};\n\nvar cheerioHtmlFile = function(htmlfile) {\n    return cheerio.load(fs.readFileSync(htmlfile));\n};\n\nvar loadChecks = function(checksfile) {\n    return JSON.parse(fs.readFileSync(checksfile));\n};\n\nvar checkHtmlFile = function(htmlfile, checksfile) {\n    $ = cheerioHtmlFile(htmlfile);\n    var checks = loadChecks(checksfile).sort();\n    var out = {};\n    for(var ii in checks) {\n        var present = $(checks[ii]).length > 0;\n        out[checks[ii]] = present;\n    }\n    return out;\n};\n\nvar clone = function(fn) {\n    // Workaround for commander.js issue.\n    // http://stackoverflow.com/a/6772648\n    return fn.bind({});\n};\n\nif(require.main == module) {\n    program\n        .option('-c, --checks <check_file>', 'Path to checks.json', clone(assertFileExists), CHECKSFILE_DEFAULT)\n        .option('-f, --file <html_file>', 'Path to index.html', clone(assertFileExists), HTMLFILE_DEFAULT)\n        .parse(process.argv);\n    var checkJson = checkHtmlFile(program.file, program.checks);\n    var outJson = JSON.stringify(checkJson, null, 4);\n    console.log(outJson);\n} else {\n    exports.checkHtmlFile = checkHtmlFile;\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":2306}]],"length":2306}
{"contributors":[],"silentsave":false,"ts":1373352399750,"patch":[[{"diffs":[[0,"uire('fs');\n"],[1,"var rest = require('restler');\n"],[0,"var program "]],"start1":746,"start2":746,"length1":24,"length2":55}]],"length":2337,"saved":false}
{"ts":1373352441455,"patch":[[{"diffs":[[0,"MLFILE_DEFAULT)\n"],[1,"        .option('-u, --url', 'URL to html page. Specify either -f or -u, but not both')\n"],[0,"        .parse(p"]],"start1":2092,"start2":2092,"length1":32,"length2":120},{"diffs":[[0,".argv);\n"],[1,"\n\n\n"],[0,"    var "]],"start1":2218,"start2":2218,"length1":16,"length2":19},{"diffs":[[0,"ll, 4);\n"],[1,"\n"],[0,"    cons"]],"start1":2340,"start2":2340,"length1":16,"length2":17},{"diffs":[[0,"tJson);\n"],[1,"\n"],[0,"} else {"]],"start1":2367,"start2":2367,"length1":16,"length2":17}]],"length":2430,"saved":false}
{"ts":1373352480054,"patch":[[{"diffs":[[0,");\n\n"],[-1,"\n\n"],[0,"    var"],[1," checkJson;\n    var outJson;\n\n    if (program.url) {\n        checkJson = checkURL(program.url, program.checks);\n    } else {\n       "],[0," che"]],"start1":2223,"start2":2223,"length1":17,"length2":147},{"diffs":[[0,"hecks);\n    "],[-1,"var"],[1,"}\n\n   "],[0," outJson = J"]],"start1":2416,"start2":2416,"length1":27,"length2":30}]],"length":2563,"saved":false}
{"ts":1373352518058,"patch":[[{"diffs":[[0,"rn out;\n};\n\n"],[1,"var checkURL = function(url, checksfile) {\n\n\n}\n\n"],[0,"var clone = "]],"start1":1696,"start2":1696,"length1":24,"length2":72}]],"length":2611,"saved":false}
{"ts":1373353082554,"patch":[[{"diffs":[[0,"lfile);\n"],[1,"    return checkHtmlHelper($, checksfile);\n};\n\nvar checkURL = function(url, checksfile) {\n    var out = {};\n    rest.get(url).on('complete', function( request, response ) {\n        $ = cheerio.load(response);\n        out = checkHtmlHelper($, checksfile);\n    });\n    return out;\n}\n\nvar checkHtmlHelper = function(cheerioDom, checksfile) {\n    $ = cheerioDom;\n"],[0,"    var "]],"start1":1497,"start2":1497,"length1":16,"length2":375},{"diffs":[[0,"le).sort();\n"],[-1,""],[0,"    var out "]],"start1":1900,"start2":1900,"length1":24,"length2":24},{"diffs":[[0,"sent;\n    }\n"],[1,""],[0,"    return o"]],"start1":2035,"start2":2035,"length1":24,"length2":24},{"diffs":[[0,"ut;\n"],[-1,"};\n\nvar checkURL = function(url, checksfile) {\n\n\n"],[0,"}\n\nv"]],"start1":2059,"start2":2059,"length1":57,"length2":8}]],"length":2921,"saved":false}
{"ts":1373353341869,"patch":[[{"diffs":[[0,"gram.url) {\n"],[1,"        console.log(program.url);\n"],[0,"        chec"]],"start1":2633,"start2":2633,"length1":24,"length2":58}]],"length":2955,"saved":false}
{"ts":1373353662796,"patch":[[{"diffs":[[0," instr;\n};\n\n"],[1,"var optionAsString = function(optionValue) {\n    return optionValue.toString();\n}\n\n"],[0,"var cheerioH"]],"start1":1210,"start2":1210,"length1":24,"length2":107},{"diffs":[[0,"ot both'"],[1,", clone(optionAsString)"],[0,")\n      "]],"start1":2627,"start2":2627,"length1":16,"length2":39}]],"length":3061,"saved":false}
{"ts":1373353756376,"patch":[[{"diffs":[[0,"    "],[-1,"if "],[1,"console.log"],[0,"(pro"]],"start1":2728,"start2":2728,"length1":11,"length2":19},{"diffs":[[0,"ram.url)"],[-1," {"],[1,";\n"],[0,"\n    "],[-1,"    console.log"],[1,"if "],[0,"(program"]],"start1":2748,"start2":2748,"length1":38,"length2":26},{"diffs":[[0,"ram.url)"],[-1,";"],[1," {"],[0,"\n       "]],"start1":2771,"start2":2771,"length1":17,"length2":18}]],"length":3058,"saved":false}
{"ts":1373353778440,"patch":[[{"diffs":[[0,"sString)"],[1,", ''"],[0,")\n      "]],"start1":2650,"start2":2650,"length1":16,"length2":20}]],"length":3062,"saved":false}
{"ts":1373354244276,"patch":[[{"diffs":[[0,"};\n\n"],[-1,"var optionAsString = function(optionValue) {\n    return optionValue.toString();\n}\n\n"],[0,"var "]],"start1":1218,"start2":1218,"length1":91,"length2":8},{"diffs":[[0,"u, --url"],[1," <html_file>"],[0,"', 'URL "]],"start1":2484,"start2":2484,"length1":16,"length2":28},{"diffs":[[0,"her "],[-1,"-"],[0,"f"],[1,"ile"],[0," or "],[-1,"-"],[0,"u"],[1,"rl"],[0,", bu"]],"start1":2537,"start2":2537,"length1":16,"length2":19},{"diffs":[[0,"oth'"],[-1,", clone(optionAsString), ''"],[0,")\n  "]],"start1":2563,"start2":2563,"length1":35,"length2":8}]],"length":2967,"saved":false}
{"ts":1373354389764,"patch":[[{"diffs":[[0,"n;\n\n    "],[-1,"console.log"],[1,"if "],[0,"(program"]],"start1":2633,"start2":2633,"length1":27,"length2":19},{"diffs":[[0,"url)"],[-1,";\n"],[1," {"],[0,"\n    "],[-1,"if (program.url) {"],[1,"    console.log(\"Checking url...\");"],[0,"\n   "]],"start1":2653,"start2":2653,"length1":33,"length2":50},{"diffs":[[0,"am.checks);\n"],[-1,""],[0,"    } else {"]],"start1":2747,"start2":2747,"length1":24,"length2":24},{"diffs":[[0,"   } else {\n"],[1,"        console.log(\"Checking file...\");\n"],[0,"        chec"]],"start1":2760,"start2":2760,"length1":24,"length2":65}]],"length":3017,"saved":false}
{"ts":1373354504686,"patch":[[{"diffs":[[0,"    "],[-1,"return checkHtmlHelper($, checksfile)"],[1,"var checks = loadChecks(checksfile).sort();\n    var out = {};\n    for(var ii in checks) {\n        var present = $(checks[ii]).length > 0;\n        out[checks[ii]] = present;\n    }\n    return out"],[0,";\n};"]],"start1":1505,"start2":1505,"length1":45,"length2":201},{"diffs":[[0,"r out = {};\n"],[1,"    console.log(\"getting url: \" + url);\n"],[0,"    rest.get"]],"start1":1757,"start2":1757,"length1":24,"length2":64},{"diffs":[[0,"    "],[-1,"$ = cheerio.load(response);\n        out = checkHtmlHelper($, checksfile);\n    });\n    return out;\n}\n\nvar checkHtmlHelper = function(cheerioDom, checksfile) {\n    $ = cheerioDom;\n"],[1,"console.log(\"request complete, checking html\");\n        $ = cheerio.load(response);\n    "],[0,"    "]],"start1":1878,"start2":1878,"length1":186,"length2":96},{"diffs":[[0,"ksfile).sort();\n"],[1,"//    "],[0,"    var out = {}"]],"start1":2002,"start2":2002,"length1":32,"length2":38},{"diffs":[[0,"r out = {};\n    "],[1,"  "],[1,"  "],[0,"for(var ii in ch"]],"start1":2030,"start2":2030,"length1":32,"length2":36},{"diffs":[[0,"ii in checks) {\n"],[1,"    "],[0,"        var pres"]],"start1":2058,"start2":2058,"length1":32,"length2":36},{"diffs":[[0,"th > 0;\n        "],[1,"    "],[0,"out[checks[ii]] "]],"start1":2118,"start2":2118,"length1":32,"length2":36},{"diffs":[[0," = present;\n    "],[-1,"}"],[1,"    }\n//        return out;\n    });"],[0,"\n    return out;"]],"start1":2153,"start2":2153,"length1":33,"length2":67}]],"length":3175,"saved":false}
{"ts":1373354526945,"patch":[[{"diffs":[[0,"    });\n"],[1,"    console.log(\"returning checks on url html\");\n"],[0,"    retu"]],"start1":2197,"start2":2197,"length1":16,"length2":65}]],"length":3224,"saved":false}
{"ts":1373354661214,"patch":[[{"diffs":[[0,"r checkU"],[-1,"RL"],[1,"rlAsync"],[0," = funct"]],"start1":1710,"start2":1710,"length1":18,"length2":23},{"diffs":[[0,"file) {\n"],[-1,"    var out = {};\n"],[0,"    cons"]],"start1":1748,"start2":1748,"length1":34,"length2":16},{"diffs":[[0,"sort();\n"],[-1,"//"],[0,""],[1,""],[0,"        "]],"start1":1997,"start2":1997,"length1":18,"length2":16},{"diffs":[[0,"  }\n"],[-1,"//"],[0,"        "],[-1,"return out"],[1,"var outJson = JSON.stringify(out, null, 4);\n        console.log(outJson)"],[0,";\n  "]],"start1":2156,"start2":2156,"length1":28,"length2":88},{"diffs":[[0,"html\");\n"],[-1,"    return out;\n"],[0,"}\n\nvar c"]],"start1":2291,"start2":2291,"length1":32,"length2":16},{"diffs":[[0,");\n\n"],[-1,"    var checkJson;\n    var outJson;\n\n"],[0,"    "]],"start1":2832,"start2":2832,"length1":45,"length2":8},{"diffs":[[0,"heck"],[-1,"Json = checkURL"],[1,"UrlAsync"],[0,"(pro"]],"start1":2908,"start2":2908,"length1":23,"length2":16},{"diffs":[[0,"\");\n        "],[1,"var "],[0,"checkJson = "]],"start1":3001,"start2":3001,"length1":24,"length2":28},{"diffs":[[0,"    "],[-1,"}\n\n"],[0,"   "],[1," var"],[0," out"]],"start1":3074,"start2":3074,"length1":14,"length2":15},{"diffs":[[0,"ll, 4);\n"],[-1,"\n"],[1,"    "],[0,"    cons"]],"start1":3124,"start2":3124,"length1":17,"length2":20},{"diffs":[[0,"tJson);\n"],[1,"    }\n\n\n"],[0,"\n} else "]],"start1":3154,"start2":3154,"length1":16,"length2":24}]],"length":3225,"saved":false}
{"ts":1373354763429,"patch":[[{"diffs":[[0,"ecksfile) {\n"],[1,"\n"],[0,"    console."]],"start1":1744,"start2":1744,"length1":24,"length2":25},{"diffs":[[0,"+ url);\n"],[1,"\n"],[0,"    rest"]],"start1":1789,"start2":1789,"length1":16,"length2":17},{"diffs":[[0,"esponse ) {\n"],[1,"\n"],[0,"        cons"]],"start1":1851,"start2":1851,"length1":24,"length2":25},{"diffs":[[0,"ing html\");\n"],[1,"        console.log(response);\n\n"],[0,"        $ = "]],"start1":1908,"start2":1908,"length1":24,"length2":56},{"diffs":[[0,";\n        }\n"],[1,"\n"],[0,"        var "]],"start1":2183,"start2":2183,"length1":24,"length2":25},{"diffs":[[0,"n);\n"],[-1,""],[0,"    });\n"],[1,"\n"],[0,"    "]],"start1":2274,"start2":2274,"length1":16,"length2":17}]],"length":3262,"saved":false}
{"ts":1373354933813,"patch":[[{"diffs":[[0,"tion( re"],[-1,"ques"],[1,"sul"],[0,"t, respo"]],"start1":1835,"start2":1835,"length1":20,"length2":19},{"diffs":[[0,"l\");"],[-1,"\n        console.log(response);"],[0,"\n\n  "]],"start1":1914,"start2":1914,"length1":39,"length2":8},{"diffs":[[0,"load(res"],[-1,"ponse"],[1,"ult"],[0,");\n     "]],"start1":1940,"start2":1940,"length1":21,"length2":19}]],"length":3228,"saved":false}
{"contributors":[],"silentsave":false,"ts":1373386093923,"patch":[[{"diffs":[[0,"uire('fs');\n"],[1,"var rest = require('restler');\n"],[0,"var program "]],"start1":746,"start2":746,"length1":24,"length2":55},{"diffs":[[0,"E_DEFAULT)\n "],[1,"       .option('-u, --url <html_file>', 'URL to html page. Specify either file or url, but not both')\n        .parse(process.argv);\n\n    if (program.url) {\n"],[0,"        cons"]],"start1":2694,"start2":2694,"length1":24,"length2":180},{"diffs":[[0,".\");"],[1,"\n "],[0,"   "],[-1,".parse(process.argv);\n"],[1,"    checkUrlAsync(program.url, program.checks);\n    } else {\n        console.log(\"Checking file...\");\n        var checkJson = "],[0,"chec"]],"start1":2897,"start2":2897,"length1":33,"length2":139},{"diffs":[[0,"s);\n    "],[-1,"v"],[1,"    var outJson"],[0," = JSON."]],"start1":3073,"start2":3073,"length1":17,"length2":31},{"diffs":[[0,"        "],[-1,"if "],[1,"console.log"],[0,"(outJson"]],"start1":3135,"start2":3135,"length1":19,"length2":27},{"diffs":[[0," }\n\n"],[-1,"\n"],[0,"} else"],[-1,";\n\nog"],[1," {\n    "],[0,"expo"]],"start1":3168,"start2":3168,"length1":20,"length2":21}]],"length":3226,"saved":false}
